/*! BlogEspaceNutrition 10-03-2016 */
angular.module("underscore",[]).factory("_",function(){return window._}),$("#pleaseWaitDialog").hide(),angular.module("BlogEspaceNutrition",["ngRoute","underscore"]).config(["$routeProvider","$locationProvider","$httpProvider",function($routeProvider,$locationProvider,$httpProvider){var access=routingConfig.accessLevels;$routeProvider.when("/",{templateUrl:"/partials/template/blogEspaceNutrition/index.php",controller:"BlogEspaceNutritionPublicCtrl",action:"listArticles",access:access["public"]}),$routeProvider.when("/articles_:id",{templateUrl:"/partials/template/blogEspaceNutrition/article.php",controller:"BlogEspaceNutritionPublicCtrl",action:"detailArticle",access:access["public"]}),$routeProvider.when("/404",{templateUrl:"/partials/404.html",access:access["public"]}),$routeProvider.otherwise({redirectTo:"/404"}),$locationProvider.html5Mode(!0).hashPrefix("!"),$httpProvider.defaults.useXDomain=!0,$httpProvider.interceptors.push(function($q,$location,$window){return{request:function(config){config.headers=config.headers||{};var payLoad={};payLoad.iss="http://www.espace-nutrition.fr",payLoad.aud="Espace Nutrition",payLoad.exp=Math.round((new Date).getTime()/1e3)+60,payLoad.role="anonyme";var jPayLoad=JSON.stringify(payLoad);return config.headers.Authorization="BearerPublic "+utf8tob64u(jPayLoad),config},responseError:function(response){return 401===response.status?($location.path("/"),$q.reject(response)):$q.reject(response)}}})}]).run(["$rootScope","$location","$window","Auth",function($rootScope,$location,$window,Auth){$rootScope.$on("$routeChangeStart",function(event,next,current){$rootScope.error=null,void 0!==current&&void 0!==current.$$route&&($rootScope[current.$$route.originalPath.split("/")[1]]=!1),void 0!==next&&void 0!==next.$$route&&($rootScope[next.$$route.originalPath.split("/")[1]]=!0)}),$rootScope.$on("$viewContentLoaded",function(){$rootScope._style=document.createElement("link"),$rootScope._style.type="text/css",$rootScope._style.href="css/template/blogEspaceNutrition/styles.css",$rootScope._style.rel="stylesheet",$rootScope._style=document.head.appendChild($rootScope._style)})}]),function(exports){function buildRoles(roles){var bitMask="01",userRoles={};for(var role in roles){var intCode=parseInt(bitMask,2);userRoles[roles[role]]={bitMask:intCode,title:roles[role]},bitMask=(intCode<<1).toString(2)}return userRoles}function buildAccessLevels(accessLevelDeclarations,userRoles){var accessLevels={};for(var level in accessLevelDeclarations){var role,resultBitMask="";if("string"==typeof accessLevelDeclarations[level])if("*"==accessLevelDeclarations[level]){for(role in userRoles)resultBitMask+="1";accessLevels[level]={bitMask:parseInt(resultBitMask,2),title:accessLevelDeclarations[level]}}else console.log("Access Control Error: Could not parse '"+accessLevelDeclarations[level]+"' as access definition for level '"+level+"'");else{resultBitMask=0;for(role in accessLevelDeclarations[level])userRoles.hasOwnProperty(accessLevelDeclarations[level][role])?resultBitMask|=userRoles[accessLevelDeclarations[level][role]].bitMask:console.log("Access Control Error: Could not find role '"+accessLevelDeclarations[level][role]+"' in registered roles while building access for '"+level+"'");accessLevels[level]={bitMask:resultBitMask,title:accessLevelDeclarations[level][role]}}}return accessLevels}var config={roles:["public","user","admin"],accessLevels:{"public":"*",anon:["public"],userOnly:["user"],user:["user","admin"],admin:["admin"]}};exports.userRoles=buildRoles(config.roles),exports.accessLevels=buildAccessLevels(config.accessLevels,exports.userRoles)}("undefined"==typeof exports?this.routingConfig={}:exports),function(){"use strict";angular.module("BlogEspaceNutrition").factory("Auth",["$http","$window",function($http,$window){function changeUser(user){_.extend(currentUser,user)}function adaptUser(token){var result={email:"",role:userRoles["public"]};return result}var accessLevels=routingConfig.accessLevels,userRoles=routingConfig.userRoles,currentUser=adaptUser($window.sessionStorage.token);userRoles["public"];return{authorize:function(accessLevel,role){return void 0===accessLevel&&(accessLevel=userRoles.admin),void 0===role&&(role=currentUser.role),accessLevel.bitMask&role.bitMask},adaptCurrentUser:function(){changeUser(adaptUser($window.sessionStorage.token))},accessLevels:accessLevels,userRoles:userRoles,user:currentUser}}])}(),function(){"use strict";angular.module("BlogEspaceNutrition").controller("BlogEspaceNutritionPublicCtrl",["$rootScope","$scope","$location","$route","$routeParams","$window","PublicFactory","$sce",function($rootScope,$scope,$location,$route,$routeParams,$window,PublicFactory,$sce){var id,categorieJSON,action="",searchInfo={};switch(void 0!==$route&&$route.current&&void 0!==$route.current.action&&(action=$route.current.action),$scope.renderHtml=function(htmlCode){return $sce.trustAsHtml(htmlCode)},$scope.isInt=function(value){var x;return isNaN(value)?!1:(x=parseFloat(value),(0|x)===x)},$scope.listArticles=function(){$scope.success="",$scope.error="",$scope.loading=!0,$location.search().page&&$scope.isInt($location.search().page)&&($scope.page=$location.search().page),$location.search().categorie&&($scope.categorie=$location.search().categorie),PublicFactory.listArticles($scope.page,$scope.categorie,function(res){$scope.loading=!1,$scope.articles=res.result,$scope.links=res.links},function(err){$scope.error="Impossible de recuperer les articles",$scope.loading=!1}),$scope.loadData()},$scope.loadData=function(){PublicFactory.listCategories(function(res){$scope.loading=!1,$scope.categories=res,categorieJSON=_.findWhere(res,{id:$scope.categorie}),void 0!==categorieJSON&&($scope.categorieLib=categorieJSON.libelle_long)},function(err){$scope.error="Impossible de recuperer les catégories",$scope.loading=!1}),PublicFactory.listRecentMediaInstagram(function(res){$scope.loading=!1,$scope.medias=res.data},function(err){$scope.error="Impossible de recuperer les medias instagram",$scope.loading=!1})},$scope.first=function(){searchInfo.page=$scope.links.first.page,$location.search().categorie&&(searchInfo.categorie=$location.search().categorie),$location.search(searchInfo)},$scope.previous=function(){searchInfo.page=$scope.links.previous.page,$location.search().categorie&&(searchInfo.categorie=$location.search().categorie),$location.search(searchInfo)},$scope.next=function(){searchInfo.page=$scope.links.next.page,$location.search().categorie&&(searchInfo.categorie=$location.search().categorie),$location.search(searchInfo)},$scope.last=function(){searchInfo.page=$scope.links.last.page,$location.search().categorie&&(searchInfo.categorie=$location.search().categorie),$location.search(searchInfo)},$scope.detailArticle=function(id){$scope.success="",$scope.error="",$scope.loading=!0,PublicFactory.detailArticle(id,function(res){$scope.loading=!1,$scope.article=res},function(err){$scope.error="Impossible de recuperer l article",$scope.loading=!1}),$scope.loadData()},action){case"detailArticle":id=$routeParams.id,$scope.detailArticle(id);break;case"listArticles":$scope.listArticles()}}])}(),function(){"use strict";angular.module("BlogEspaceNutrition").directive("commentaires",function($location){return{link:function(scope,element,attrs){var articleId=($(element),fyre.conv.load.makeArticleId($location.absUrl())),customStrings={signIn:"Identification",signInGuest:"Se connecter en invité",signOut:"Déconnexion",editProfile:"Éditer le profil",siteAdmin:"Administration",postButton:"Poster",postAsButton:"Poster en tant que",postEditButton:"Éditer",postEditCancelButton:"Annuler",commentCountLabel:"commentaire",commentCountLabelPlural:"commentaires",listenerCountLabel:"abonné",listenerCountLabelPlural:"abonnés",likeButton:"J'aime",unlikeButton:"J'aime pas",editButton:"Éditer",replyButton:"Répondre",follow:"S'abonner",unfollow:"Se désabonner",banUserButton:"Bannir",deleteButton:"Supprimer",flagButton:"Marquer",shareButton:"Partager",sortNewest:"Les plus récents",sortOldest:"Les plus anciens",sortLabel:"Ordre",sortSeparator:" ",banTitle:"Bannir l'utilisateur",banConfirmation:"Êtes-vous sur de vouloir bannir cet utilisateur ?",banConfirmButton:"OK",banCancelButton:"Annuler",flagSpam:"Spam",flagOffensive:"Offensant",flagDisagree:"Désaccord",flagOffTopic:"Hors-sujet",flagTitle:"Le sujet de %s",flagSubtitle:"Marquer comme",flagEmail:"Email",flagEmailPlaceholder:"vous@exemple.org",flagNotes:"Notes",flagNotesPlaceholders:"Votre commentaire ici",flagConfirmButton:"OK",flagCancelButton:"Annuler",flagSuccessMsg:"Le message a bien été marqué",shareDefaultText:"Tu devrais lire ce commentaire !",shareTitle:"Partager le commentaire",shareButtonText:"Partager",shareLabel:"Partager sur :",sharePermalink:"Permalien",mentionTitle:"Partager la mention",mentionSubtitleFacebook:"Partager ce commentaire Facebook à :",mentionSubtitleTwitter:"Partager ce commentaire Twitter à :",mentionDefaultText:"Je t'ai mentionné dans un commentaire",mentionConfirmButton:"OK",mentionCancelButton:"Annuler",mentionSuccessMsg:"La mention a bien été partagée",mentionErrorNoneSelected:"Aucun pseudo n'a été selectionné",mentionErrorGeneral:"Erreur lors de l'envoi du partage de mention. Veuillez réessayer ultérieurement",timeJustNow:"à l'instant",timeMinutesAgo:"minute plus tôt",timeMinutesAgoPlural:"minutes plus tôt",timeHoursAgo:"heure plus tôt",timeHoursAgoPlural:"%s heures plus tôt",timeDaysAgo:"jour plus tôt",timeDaysAgoPlural:"jours plus tôt",errorAuthError:"Erreur lors de l'authentification",errorCommentsNotAllowed:"Commentaire non autorisé",errorDuplicate:"Même si vous aimez votre commentaire, vous n'êtes pas autorisé à le publier deux fois",errorEditDuplicate:"Vous ne pouvez pas éditer ce commentaire",errorEditNotAllowed:"L'édition du commentaire n'est pas autorisé",errorEmpty:"Votre commentaire est vide. Veuillez rédiger un message",errorInsufficientPermissions:"Vous n'avez pas les droits suffisants pour effectuer cette opération",errorInvalidChar:"Des caractères non-autorisés se sont glissés dans votre message, revoyez votre copie ;)",errorLikeOwnComment:"Vous ne pouvez aimer votre propre commentaire.",errorMalformed:"Le contenu de votre commentaire n'est pas valide, revoyez votre copie ;)",errorMaxChars:"Votre commentaire dépasse la limite de caractères autorisée.",errorExpired:"Session expirée. Veuillez rafraîchir cette page",errorDefault:"Une erreur s'est produite, veuillez renouveler l'opération ultérieurement"},convConfig={};convConfig.strings=customStrings,fyre.conv.load({},[convConfig,{el:"livefyre-comments",network:"livefyre.com",siteId:"380803",articleId:articleId,signed:!1,collectionMeta:{articleId:articleId,url:fyre.conv.load.makeCollectionUrl($location.absUrl(),[],!0)}}],function(){})}}})}(),function(){"use strict";angular.module("BlogEspaceNutrition").factory("PublicFactory",["$http","$window",function($http,$window){var range,rangeMin,rangeMax,userRoles=routingConfig.userRoles,nbArticlesParPages=5,uriRange="",uriCategorie="";return{listArticles:function(page,categorie,success,error){void 0!==page||void 0!==categorie?(void 0!==page&&(rangeMin=parseInt(page)*nbArticlesParPages-nbArticlesParPages,rangeMax=parseInt(page)*nbArticlesParPages-1,range=rangeMin.toString().concat("-").concat(rangeMax.toString()),uriRange="range="+range),void 0!==categorie&&(uriCategorie="categorie="+categorie),$http.get("/api/articles?"+uriRange+"&"+uriCategorie).success(success).error(error)):$http.get("/api/articles").success(success).error(error)},detailArticle:function(id,success,error){$http.get("/api/articles/"+id).success(success).error(error)},listCategories:function(success,error){$http.get("/api/categories").success(success).error(error)},listRecentMediaInstagram:function(success,error){$http.jsonp("https://api.instagram.com/v1/users/self/media/recent/?access_token=2075471567.2a4ef82.6d421a057b2b467d9bf32873c36cda74&callback=JSON_CALLBACK").success(success).error(error)},userRoles:userRoles}}])}();